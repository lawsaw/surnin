var modalAwesome = {



    'default': {
        'layout': {
            'container' : 'modalAwesome',
            'win' : 'modalAwesome-win',
        },
        'action': {
            'open': 'awModalOpen',
            'close': 'awModalClose',
        },
        'dinamic': {
            'open': 'modalAwesome--opening',
            'close': 'modalAwesome--closing',
            'active'    : 'modalAwesome--active',
            'animating'    : 'modalAwesome--animating',
            'first'     : 'modalAwesome-first',
            'htmlActive': 'modalAwesome--lightbox',
            'html': {
                'active' : 'modalAwesome--lightbox',
                'closing' : 'modalAwesome--lightbox-closing',
            },
        },


        'attr': {
            'id': 'awesome-modal',
            'mode': 'awesome-modal-mode',
            'ajax': 'awesome-modal-ajax',
            'animIn': 'awesome-modal-anim-in',
            'animOut': 'awesome-modal-anim-out',
            'workClass': 'awesome-modal-workClass',
            'winClass': 'awesome-modal-winClass',
            'layout': 'awesome-modal-layout',
            'model': 'awesome-modal-model',
        },

        'timeAnimOpen': 750,
        'timeAnimClose': 300,
        'attrDeep': 'modalAwesome-deep',
        'scrolled': siteOptions.scrolled(),
    },



    'click': function(){
        var parentObj = this;
        $(document).on('click', '.'+this.default.action.open, function(){
            var modalId = $(this).data(parentObj.default.attr.id);
            if(parentObj.isModalInHtml(modalId)) {
                $(window).trigger(siteOptions.trigger.modalAwesomeButtonOpenClick, {'button':$(this), 'modalId':modalId});
                parentObj.open(modalId);
            } else {
                $(window).trigger(siteOptions.trigger.modalAwesomeButtonOpenClickAjax, {
                    'button': $(this),
                    'modalId': modalId
                });
            }

        });
        $(document).on('click', '.'+this.default.action.close, function(){
            var modalId = $(this).parents('.'+parentObj.default.layout.container).data(parentObj.default.attr.id);
            if(parentObj.isAnyModalAnimating()) {
                return false;
            }
            $(window).trigger(siteOptions.trigger.modalAwesomeButtonCloseClick, modalId);
            parentObj.close(modalId);
        });
    },

    
    'isAnyModalActive': function(){
        return siteOptions.wrap.modal().find('.'+this.default.layout.container+'.'+this.default.dinamic.active).length > 0 ? true : false;
    },


    'isLastModalActive': function(){
        return siteOptions.wrap.modal().find('.'+this.default.layout.container+'.'+this.default.dinamic.active).length == 1 ? true : false;
    },


    'isAnyModalAnimating': function(){
        return siteOptions.wrap.modal().find('.'+this.default.layout.container+'.'+this.default.dinamic.animating).length > 0 ? true : false;
    },


    'getModalActiveIdFromChild': function(child){
        return $(child).parents('.'+this.default.layout.container).attr('data-'+this.default.attr.id);
    },


    'getDeep': function(modalId){
        var modal = siteOptions.wrap.modal().find('.'+this.default.layout.container + '[data-'+this.default.attr.id+'="'+modalId+'"]');
        return modal.attr(this.default.attrDeep);
    },


    'updateDeep': function(direction){
        var activeModalList = siteOptions.wrap.modal().find('.'+this.default.layout.container+'.'+this.default.dinamic.active),
            parentObj = this;
        activeModalList.each(function(){
            var modal = $(this),
                modalId = modal.attr('data-'+parentObj.default.attr.id);
            switch (direction) {
                case 'up':
                    if(+(parentObj.getDeep(modalId)) >= 0) {
                        //console.log('up');
                        modal.attr(parentObj.default.attrDeep, Number(modal.attr(parentObj.default.attrDeep))+1);
                    }
                    break;
                case 'down':
                    if(+(parentObj.getDeep(modalId)) != 0) {
                        //console.log('down');
                        modal.attr(parentObj.default.attrDeep, Number(modal.attr(parentObj.default.attrDeep))-1);
                    }
                    break;
                default:
                    break;
            }
        });
    },



    'movePage': function(modalId) {
        var parentObj = this,
            page = siteOptions.wrap.page(),
            modal = siteOptions.wrap.modal().find('.'+parentObj.default.layout.container + '[data-'+parentObj.default.attr.id+'="'+modalId+'"]'),
            win = siteOptions.wrap.modal().find('.'+parentObj.default.layout.container + '[data-'+parentObj.default.attr.id+'="'+modalId+'"]').find('.'+parentObj.default.layout.win),
            modeId = modal.data(this.default.attr.mode),
            width = win.css('width'),
            height = win.css('height');
        siteOptions.setDinamicEvent({
            'elem' : page,
            'event' : siteOptions.trigger.modalAwesome,
            'time' : parentObj.default.timeAnimOpen
        });
        //page.trigger(siteOptions.trigger.modalAwesome);
        switch (modeId) {

            case 'sidebarLeft':
                page.addClass('wrapPage--animating')
                    .css({
                    'transform' : 'translate3d('+width+', 0, 0)'
                });
                break;
            case 'sidebarRight':
                page.addClass('wrapPage--animating')
                    .css({
                    'transform' : 'translate3d(-'+width+', 0, 0)'
                });
                break;
            case 'sidebarTop':
                page.addClass('wrapPage--animating')
                    .css({
                    'transform' : 'translate3d(0, '+height+', 0)'
                });
                break;
            case 'sidebarBottom':
                page.addClass('wrapPage--animating')
                    .css({
                    'transform' : 'translate3d(0, -'+height+', 0)'
                });
                break;
            default:
                page.css({
                    'transform' : 'none'
                }).removeClass('wrapPage--animating');
        }

    },



    'isSidebar': function(modalId) {
        var modal = siteOptions.wrap.modal().find('.'+this.default.layout.container + '[data-'+this.default.attr.id+'="'+modalId+'"]'),
            modeId = modal.data(this.default.attr.mode);
        list = [
            'sidebarLeft',
            'sidebarRight',
            'sidebarTop',
            'sidebarBottom'
        ];
        for(var i in list) {
            if(modeId == list[i]) {
                return true;
            }
        }
        return false;
    },



    'isModalInHtml': function(modalId) {
        var modal = siteOptions.wrap.modal().find('.'+this.default.layout.container + '[data-'+this.default.attr.id+'="'+modalId+'"]');
        return modal.length ? true : false;
    },



    'buildUrl': function(modalId) {
        var url = parse_url(window.location.href),
            href = url.scheme + '://' + url.host + (url.port ? ':' + url.port : '') + url.path + '#' + modalId;
        window.history.pushState("", "", href);
        document.location = document.location + '#' + modalId;
        window.location.href = href;
    },



    'open': function(modalId){
        var modal = siteOptions.wrap.modal().find('.'+this.default.layout.container + '[data-'+this.default.attr.id+'="'+modalId+'"]'),
            parentObj = this;

        if(!this.isLightbox()) {
            this.lightbox('enter');
        }

        modal.addClass(parentObj.default.dinamic.animating).addClass(parentObj.default.dinamic.open);

        setTimeout(function(){
            modal.addClass(parentObj.default.dinamic.active);
        },50);

        this.updateDeep('up');
        modal.attr(this.default.attrDeep, 0);
        //siteOptions.scrolled();
        setTimeout(function(){
            modal.removeClass(parentObj.default.dinamic.open);
            $('html, body').animate({scrollTop: 0}, 1000);
        },parentObj.default.timeAnimOpen);
        setTimeout(function(){

            modal.removeClass(parentObj.default.dinamic.animating);
        },parentObj.default.timeAnimOpen + 1000);
        if(this.isSidebar(modalId)) {
            this.movePage(modalId);
        }
        $(window).trigger(siteOptions.trigger.modalAwesomeOpen, modalId);
        return false;
    },



    'close': function(modalId){
        var modal = siteOptions.wrap.modal().find('.'+this.default.layout.container + '[data-'+this.default.attr.id+'="'+modalId+'"]'),
            timeForCloseAnim = this.isLastModalActive() ? this.default.timeAnimClose : this.default.timeAnimClose,
            parentObj = this;
        modal.addClass(this.default.dinamic.animating);
        modal.addClass(this.default.dinamic.close);
        setTimeout(function(){
            parentObj.updateDeep('down');
        },timeForCloseAnim/4);
        if(this.isLastModalActive()) {
            siteOptions.wrap.html().addClass(parentObj.default.dinamic.html.closing);
        }
        history.pushState("", document.title, window.location.pathname);
        setTimeout(function(){
            modal
                .removeClass(parentObj.default.dinamic.close)
                .removeClass(parentObj.default.dinamic.active)
                .removeClass(parentObj.default.dinamic.animating);
            setTimeout(function(){
                if(!parentObj.isAnyModalActive()) {
                    parentObj.lightbox('exit');
                }
            },50);
        },timeForCloseAnim);
        if(this.isSidebar(modalId)) {
            this.movePage(false);
        }

        if(modal.is('[data-'+parentObj.default.attr.ajax+'="true"]')) {
            $(window).trigger(siteOptions.trigger.modalAwesomeCloseAjax, {
                'modal':modal,
                'modalId': modalId,
                'timeForCloseAnim': timeForCloseAnim
            });
        } else {
            $(window).trigger(siteOptions.trigger.modalAwesomeClose, modalId);
        }

    },



    'openFromUrl': function(){
        var href = url().fragment,
            list = this.getListOfModals(),
            parentObj = this;
        if(parentObj.isModalInHtml(href)) {
            for(var i=0; i<list.length; i++) {
                if(href == list[i]) {
                    var modalId = href;
                    if(modalId) {
                        setTimeout(function(){
                            parentObj.open(modalId);
                        },1000);
                    }
                    break;
                }
            }
        } else {
            var button = $(document).find('.' + parentObj.default.action.open + '[data-' + parentObj.default.attr.id + '="' + href + '"]');
            setTimeout(function(){
                button.click();
            },1000);
        }


    },



    'getListOfModals': function(){
        var modal = siteOptions.wrap.modal().find('.'+this.default.layout.container),
            list = [],
            parentObj = this;
        modal.each(function(){
           var modalId = $(this).attr('data-'+parentObj.default.attr.id);
           list.push(modalId);
        });
        return list;
    },



    'init' : function(options){

        this.click();
        this.openFromUrl();

    },



    'isLightbox' : function() {
        return siteOptions.wrap.html().hasClass(this.default.dinamic.html.active) ? true : false;
    },



    'lightbox' : function(event) {
        var html = siteOptions.wrap.html(),
            parentObj = this;
        switch (event) {
            case 'enter':
                siteOptions.scrolledStatic = siteOptions.scrolled();
                siteOptions.wrap.page().css({
                    'top' : -siteOptions.scrolledStatic
                });
                html.addClass(this.default.dinamic.html.active);
                break;
            case 'exit':
                siteOptions.wrap.page().css({
                    'top' : 'auto'
                });
                html.removeClass(parentObj.default.dinamic.html.active).removeClass(parentObj.default.dinamic.html.closing);
                $(document).scrollTop(siteOptions.scrolledStatic);
                break;
            default:
                break;
        }
    },



};